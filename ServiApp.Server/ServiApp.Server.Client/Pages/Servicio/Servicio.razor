@page "/servicios"
@inject IHttpServicio http
@inject NavigationManager nav
@rendermode InteractiveServer

<PageTitle>Servicios Disponibles</PageTitle>
<link rel="stylesheet" href="css/servicios.css" />
<div class="page-background"></div>

<div class="container mt-4 position-relative" style="z-index: 2; padding-bottom: 2rem;">
    <h3 class="mb-4 text-primary fw-bold">Servicios Disponibles</h3>
    <div class="filtros mb-4">
        <button class="btn btn-outline-primary me-2" @onclick="MostrarTodos">
            <i class="bi bi-list-ul"></i> Mostrar Todos
        </button>
        <button class="btn btn-outline-secondary" @onclick="IrABuscarPorCategoria">
            <i class="bi bi-search"></i> Buscar por Categoría
        </button>
    </div>
    @if (servicios == null)
    {
        <div class="text-center mt-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-2">Cargando servicios...</p>
        </div>
    }
    else if (servicios.Count == 0)
    {
        <div class="alert alert-info text-center mt-4" role="alert">
            No se encontraron servicios.
        </div>
    }
    else
    {
        <div class="list-group">
            @foreach (var servicio in servicios)
            {
                <a href="#" class="list-group-item list-group-item-action"
                   @onclick="() => SeleccionarServicio(servicio.Id)"
                @onclick:preventDefault>
                    <div class="d-flex w-100 justify-content-between align-items-center">
                        <h5 class="mb-1 fw-semibold">@servicio.Nombre</h5>
                        <small class="text-success fw-bold">
                            $@servicio.PrecioBase
                        </small>
                    </div>
                    <p class="mb-1 text-muted">@servicio.Descripcion</p>
                    <div class="d-flex justify-content-between align-items-center mt-2">
                        <small class="text-secondary">
                            <i class="bi bi-person-circle"></i> @servicio.NombrePrestador
                        </small>
                        <small class="text-secondary">
                            <i class="bi bi-geo-alt"></i> @servicio.Ubicacion
                        </small>
                    </div>
                </a>
            }
        </div>
    }
</div>
@code {
    private List<ServicioDTO>? servicios;
    protected override async Task OnInitializedAsync()
    {
        await CargarServicios();
    }
    private async Task CargarServicios()
    {
        var response = await http.Get<List<ServicioDTO>>("api/servicioController");
        servicios = (!response.Error && response.Respuesta != null)
            ? response.Respuesta
            : new List<ServicioDTO>();
    }
    private async Task MostrarTodos()
    {
        servicios = null; // Para mostrar el spinner
        await CargarServicios();
    }
    private void IrABuscarPorCategoria()
    {
        nav.NavigateTo("/categorias");
    }
    private void SeleccionarServicio(int servicioId)
    {
        nav.NavigateTo($"/servicio/{servicioId}");
    }
}